<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Color Survey</title>
<link rel="stylesheet" href="bulma.min.css">
<style>
.cb {
    width: 5rem;
}
.cbp:not(:last-child) {
    margin-bottom: .75rem;
}
</style>
</head>
<body>
<!--<div id="response"></div>-->

<section class="section">
<div class="container">

<h1 class="title">Color Cycle Survey</h1>

<div class="columns">
<!--<div id="cycles">-->
  <div class="column">
  <div id="cycle1" class="cycle card">
    <header class="card-header">
    <p class="card-header-title">Cycle A</p>
    </header>
    <div class="card-content">
    <div class="columns is-vcentered has-text-centered">
    <div class="column is-narrow">
    <p class="cbp"><span class="tag is-medium cb" id="c1c0"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c1c1"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c1c2"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c1c3"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c1c4"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c1c5"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c1c6"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c1c7"></span></p>
    </div>
    <div class="column">
    <canvas id="canvas1"></canvas>
    </div>
    </div>
    </div>
    <footer class="card-footer">
    <a href="#" id="pick1" class="card-footer-item">Pick</a>
    </footer>
  </div>
  </div>
  <div class="column">
  <div id="cycle2" class="cycle card">
    <header class="card-header">
    <p class="card-header-title">Cycle B</p>
    </header>
    <div class="card-content">
    <div class="columns is-vcentered has-text-centered">
    <div class="column is-narrow">
    <p class="cbp"><span class="tag is-medium cb" id="c2c0"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c2c1"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c2c2"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c2c3"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c2c4"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c2c5"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c2c6"></span></p>
    <p class="cbp"><span class="tag is-medium cb" id="c2c7"></span></p>
    </div>
    <div class="column">
    <canvas id="canvas2"></canvas>
    </div>
    </div>
    </div>
    <footer class="card-footer">
    <!--<button id="pick2" class="button">Pick 2</button>-->
     <a href="#" id="pick2" class="card-footer-item">Pick</a>
    </footer>
  </div>
  </div>
<!--</div>-->
</div>

</div>
</div>

<script>
//let response = document.querySelector('#response')
let set1 = 1,
    set2 = 1;
function submit(pick) {
    let xhr = new XMLHttpRequest();
    let formData = new FormData();
    //formData.append("val", 'test val data');
    formData.append("Set1", set1);
    formData.append("Set2", set2);
    formData.append("Pick", pick)
    xhr.responseType = 'json';
    xhr.open("POST", "/post_color");
    xhr.onreadystatechange = function() {//Call a function when the state changes.
        if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
            // Request finished. Do processing here.
            //response.textContent = JSON.stringify(xhr.response);
            console.log(xhr.response);
            set1 = xhr.response.Set1;
            set2 = xhr.response.Set2;
            for (let i = 0; i < 8; i++) {
                document.querySelector('#c1c' + i).style.background = set1[i];
                document.querySelector('#c2c' + i).style.background = set2[i];
            }
            ctx1.clearRect(0, 0, canvas1.width, canvas1.height);
            ctx2.clearRect(0, 0, canvas2.width, canvas2.height);
            if (Math.random() >= 0.5) {
                let s = Math.random() >= 0.5 ? 4 : 8;
                drawScatter(ctx1, s, set1);
                drawScatter(ctx2, s, set2);
            } else {
                let s = Math.random() >= 0.5 ? 2 : 4;
                drawLine(ctx1, s, set1);
                drawLine(ctx2, s, set2);
            }
        }
    }
    xhr.send(formData);
}
document.querySelector('#pick1').addEventListener('click', function(e) {
    e.preventDefault();
    submit(1);
});
document.querySelector('#pick2').addEventListener('click', function(e) {
    e.preventDefault();
    submit(2);
});






let size = 200;

let canvas1 = document.getElementById('canvas1');
canvas1.width = canvas1.height = size;
let ctx1 = canvas1.getContext('2d');
let canvas2 = document.getElementById('canvas2');
canvas2.width = canvas2.height = size;
let ctx2 = canvas2.getContext('2d');

const scatter_positions = [
    [0.766, 0.204],
    [0.593, 0.488],
    [0.379, 0.353],
    [0.211, 0.517],
    [0.657, 0.796],
    [0.836, 0.506],
    [0.454, 0.785],
    [0.732, 0.658],
    [0.543, 0.251],
    [0.418, 0.546],
    [0.164, 0.721],
    [0.205, 0.263],
];

function drawScatter(ctx, radius, colors) {
    for (let i = 0; i < Math.min(colors.length, scatter_positions.length); i++) {
        let p = scatter_positions[i];
        ctx.beginPath();
        ctx.fillStyle = colors[i];
        ctx.arc(p[0] * size, p[1] * size, radius, 0, 2 * Math.PI);
        ctx.fill();
    }
}

const lines = {
    5: [
        [ 0.188, 0.074, 0.046, 0.059, 0.137, 0.108, 0.117, 0.134, 0.162, 0.178],
        [ 0.358, 0.258, 0.394, 0.287, 0.272, 0.21 , 0.339, 0.309, 0.336, 0.359],
        [ 0.417, 0.447, 0.563, 0.566, 0.53 , 0.588, 0.424, 0.514, 0.437, 0.478],
        [ 0.737, 0.629, 0.78 , 0.783, 0.755, 0.685, 0.789, 0.616, 0.656, 0.654],
        [ 0.89 , 0.959, 0.909, 0.804, 0.853, 0.847, 0.873, 0.824, 0.912, 0.996]
    ],
    8: [
        [ 0.016, 0.092, 0.044, 0.062, 0.103, 0.118, 0.002, 0.061, 0.005, 0.098],
        [ 0.141, 0.209, 0.202, 0.233, 0.196, 0.249, 0.157, 0.127, 0.133, 0.179],
        [ 0.311, 0.359, 0.258, 0.266, 0.316, 0.329, 0.344, 0.283, 0.347, 0.316],
        [ 0.473, 0.494, 0.46 , 0.477, 0.388, 0.461, 0.486, 0.416, 0.48 , 0.386],
        [ 0.562, 0.5  , 0.569, 0.502, 0.603, 0.602, 0.62 , 0.583, 0.624, 0.518],
        [ 0.671, 0.663, 0.653, 0.683, 0.667, 0.747, 0.716, 0.644, 0.682, 0.632],
        [ 0.837, 0.855, 0.793, 0.869, 0.861, 0.812, 0.797, 0.805, 0.867, 0.818],
        [ 0.89 , 0.921, 0.912, 0.932, 0.882, 0.932, 0.883, 0.995, 0.916, 0.91 ]
    ],
    10: [
        [ 0.074, 0.068, 0.068, 0.035, 0.068, 0.078, 0.079, 0.076, 0.022, 0.073],
        [ 0.181, 0.171, 0.131, 0.152, 0.133, 0.116, 0.177, 0.112, 0.196, 0.118],
        [ 0.283, 0.207, 0.218, 0.268, 0.273, 0.254, 0.226, 0.264, 0.233, 0.224],
        [ 0.331, 0.342, 0.32 , 0.325, 0.373, 0.384, 0.305, 0.343, 0.346, 0.383],
        [ 0.412, 0.459, 0.406, 0.422, 0.494, 0.49 , 0.458, 0.446, 0.477, 0.456],
        [ 0.544, 0.591, 0.562, 0.599, 0.597, 0.54 , 0.581, 0.544, 0.565, 0.564],
        [ 0.682, 0.65 , 0.638, 0.607, 0.651, 0.64 , 0.681, 0.661, 0.609, 0.654],
        [ 0.726, 0.758, 0.766, 0.776, 0.786, 0.775, 0.739, 0.737, 0.738, 0.767],
        [ 0.886, 0.803, 0.845, 0.871, 0.874, 0.85 , 0.827, 0.895, 0.811, 0.882],
        [ 0.916, 0.924, 0.978, 0.956, 0.96 , 0.959, 0.984, 0.978, 0.982, 0.95 ]
    ],
    12: [
        [ 0.027, 0.069, 0.027, 0.006, 0.081, 0.026, 0.081, 0.064, 0.078, 0.004],
        [ 0.142, 0.155, 0.097, 0.089, 0.107, 0.138, 0.123, 0.135, 0.095, 0.109],
        [ 0.21 , 0.242, 0.18 , 0.233, 0.211, 0.241, 0.17 , 0.237, 0.223, 0.237],
        [ 0.294, 0.259, 0.281, 0.295, 0.278, 0.285, 0.281, 0.289, 0.307, 0.292],
        [ 0.375, 0.355, 0.386, 0.374, 0.396, 0.367, 0.349, 0.409, 0.363, 0.338],
        [ 0.473, 0.458, 0.442, 0.495, 0.481, 0.486, 0.482, 0.423, 0.484, 0.454],
        [ 0.58 , 0.528, 0.55 , 0.503, 0.569, 0.508, 0.551, 0.57 , 0.515, 0.553],
        [ 0.638, 0.646, 0.62 , 0.639, 0.633, 0.598, 0.652, 0.621, 0.585, 0.612],
        [ 0.698, 0.745, 0.685, 0.681, 0.721, 0.707, 0.714, 0.712, 0.737, 0.681],
        [ 0.788, 0.816, 0.754, 0.768, 0.791, 0.813, 0.773, 0.8  , 0.814, 0.8  ],
        [ 0.894, 0.839, 0.869, 0.841, 0.909, 0.851, 0.844, 0.864, 0.886, 0.839],
        [ 0.94 , 0.981, 0.941, 0.929, 0.917, 0.937, 0.94 , 0.974, 0.972, 0.935]
    ]
};
function drawLine(ctx, thickness, colors) {
    ctx.lineWidth = thickness;
    for (let i = 0; i < colors.length; i++) {
        ctx.beginPath();
        ctx.strokeStyle = colors[i];
        ctx.moveTo(0.05 * size, lines[colors.length][i][0] * (size - 10) + 5);
        for (let j = 1; j < 10; j++)
            ctx.lineTo((0.05 + j / 10) * size, lines[colors.length][i][j] * (size - 10) + 5);
        ctx.stroke();
    }
}
</script>
</body>
</html>
